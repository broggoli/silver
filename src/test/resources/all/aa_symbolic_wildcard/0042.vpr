// Any copyright is dedicated to the Public Domain.
// http://creativecommons.org/publicdomain/zero/1.0/

field next: Ref

predicate valid(list: Ref) {
		 acc(list.next, write)
	&& (list.next != null ==> acc(valid(list.next), write))
}

function size(list: Ref): Int
  requires acc(valid(list), sWildcard)
  ensures result >= 1
{
	unfolding acc(valid(list), sWildcard) in (list.next == null ? 1 : 1 + size(list.next))
}

method testFails1(list: Ref) {
  //:: ExpectedOutput(assert.failed:assertion.false)
	assert list != null
}

method testFails2(list: Ref)
 	requires acc(valid(list), sWildcard)
{
  //:: ExpectedOutput(assert.failed:assertion.false)
 	assert list != null
}

method testSuccess1(list: Ref)
	requires acc(list.next, sWildcard)
{
	assert list != null
}

method testSuccess2(list: Ref)
	requires acc(valid(list), sWildcard)
{
	unfold acc(valid(list), sWildcard)
	assert list != null
}
